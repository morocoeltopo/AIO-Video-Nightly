<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
	xmlns:tools="http://schemas.android.com/tools"
	tools:ignore="AllFilesAccessPolicy,ScopedStorage,ForegroundServicesPolicy,RequestInstallPackagesPolicy">

	<!-- =======================
	     Required Permissions
	     ======================= -->

	<!-- Internet access for network requests (API, downloads, Parse server, etc.) -->
	<uses-permission android:name="android.permission.INTERNET" />

	<!-- Network state check (Wi-Fi/Mobile Data detection) -->
	<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />

	<!-- Wi-Fi state info (used in telemetry/logging) -->
	<uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />

	<!-- Push notifications support (Android 13+) -->
	<uses-permission android:name="android.permission.POST_NOTIFICATIONS" />

	<!-- Vibration control (for notifications and alerts) -->
	<uses-permission android:name="android.permission.VIBRATE" />

	<!-- Auto-start and background service management -->
	<uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
	<uses-permission android:name="android.permission.WAKE_LOCK" />

	<!-- All files access (Android 11+, requires justification on Play Store) -->
	<uses-permission android:name="android.permission.MANAGE_EXTERNAL_STORAGE" />

	<!-- File access (legacy support for Android <= 12 / API 32) -->
	<uses-permission
		android:name="android.permission.WRITE_EXTERNAL_STORAGE"
		android:maxSdkVersion="32" />
	<uses-permission
		android:name="android.permission.READ_EXTERNAL_STORAGE"
		android:maxSdkVersion="32" />

	<!-- Foreground service permissions -->
	<!-- Used for handling background operations such as sync, downloads, and playback -->
	<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
	<uses-permission android:name="android.permission.FOREGROUND_SERVICE_DATA_SYNC" />
	<uses-permission android:name="android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK" />

	<!-- APK installation permission (used for installing APKs directly from the app) -->
	<uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />

	<!-- =======================
	     Application Config
	     ======================= -->
	<application
		android:name="app.core.AIOApp"
		android:enableOnBackInvokedCallback="true"
		android:extractNativeLibs="true"
		android:hardwareAccelerated="true"
		android:icon="@mipmap/ic_launcher_v2"
		android:label="@string/title_app_name"
		android:largeHeap="true"
		android:requestLegacyExternalStorage="true"
		android:roundIcon="@mipmap/ic_launcher_v2"
		android:supportsRtl="false"
		android:theme="@style/style.application"
		android:usesCleartextTraffic="true"
		tools:targetApi="33">

		<!-- Launcher activity (entry point of the app) -->
		<activity
			android:name="app.ui.others.startup.LauncherActivity"
			android:exported="true">
			<intent-filter>
				<action android:name="android.intent.action.MAIN" />
				<category android:name="android.intent.category.LAUNCHER" />
			</intent-filter>
		</activity>

		<!-- Splash/Opening screen activity -->
		<activity
			android:name="app.ui.others.startup.OpeningActivity"
			android:excludeFromRecents="true"
			android:launchMode="singleTop"
			android:noHistory="true"
			android:resizeableActivity="true"
			android:taskAffinity=""
			android:windowSoftInputMode="adjustResize" />

		<!-- Activity for intercepting share/send intents -->
		<activity
			android:name="app.ui.others.information.IntentInterceptActivity"
			android:clearTaskOnLaunch="true"
			android:excludeFromRecents="true"
			android:exported="true"
			android:label="@string/text_empty_string"
			android:launchMode="singleTop"
			android:noHistory="true"
			android:resizeableActivity="true"
			android:taskAffinity=""
			android:theme="@style/style.transparent_activity"
			android:windowSoftInputMode="adjustResize">
			<intent-filter>
				<action android:name="android.intent.action.SEND" />
				<category android:name="android.intent.category.DEFAULT" />
				<data android:mimeType="text/plain" />
			</intent-filter>
		</activity>

		<!-- Built-in media player activity -->
		<activity
			android:name="app.ui.others.media_player.MediaPlayerActivity"
			android:exported="false"
			android:label="@string/title_aio_video_player"
			android:launchMode="singleTop"
			android:resizeableActivity="true"
			android:supportsPictureInPicture="true"
			android:theme="@style/style.application.video_player_activity"
			android:windowSoftInputMode="adjustResize" />

		<!-- Main container activity -->
		<activity
			android:name="app.ui.main.MotherActivity"
			android:alwaysRetainTaskState="true"
			android:excludeFromRecents="false"
			android:exported="false"
			android:hardwareAccelerated="true"
			android:launchMode="singleTop"
			android:taskAffinity="com.aio.mother"
			android:theme="@style/style.application"
			android:windowSoftInputMode="adjustPan" />

		<!-- Advance browser settings activity -->
		<activity
			android:name="app.ui.main.fragments.settings.activities.browser.AdvBrowserSettingsActivity"
			android:exported="false"
			android:launchMode="singleTop"
			android:windowSoftInputMode="adjustPan" />

		<!-- User feedback screen -->
		<activity
			android:name="app.ui.others.information.UserFeedbackActivity"
			android:exported="false"
			android:launchMode="singleTop"
			android:windowSoftInputMode="adjustPan" />

		<!-- Browser: Bookmarks -->
		<activity
			android:name="app.ui.main.fragments.browser.activities.BookmarksActivity"
			android:exported="false"
			android:launchMode="singleTop"
			android:windowSoftInputMode="adjustPan" />

		<!-- Browser: History -->
		<activity
			android:name="app.ui.main.fragments.browser.activities.HistoryActivity"
			android:exported="false"
			android:launchMode="singleTop"
			android:windowSoftInputMode="adjustPan" />

		<!-- Empty layout screen (utility activity) -->
		<activity
			android:name="app.ui.others.startup.EmptyLayoutActivity"
			android:exported="false"
			android:launchMode="singleTop"
			android:windowSoftInputMode="adjustPan" />

		<!-- Foreground service handling downloads/sync -->
		<service
			android:name="app.core.engines.services.AIOForegroundService"
			android:enabled="true"
			android:exported="false"
			android:foregroundServiceType="dataSync" />

		<!-- Foreground service for media playback -->
		<service
			android:name="app.ui.others.media_player.MediaPlaybackService"
			android:exported="true"
			android:foregroundServiceType="mediaPlayback"
			android:permission="android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK">
			<intent-filter>
				<action android:name="androidx.media3.session.MediaSessionService" />
			</intent-filter>
		</service>

		<!-- Broadcast receiver for restarting idle services -->
		<receiver
			android:name="app.core.engines.services.RestartIdleServiceReceiver"
			android:enabled="true"
			android:exported="false" />

		<!-- File provider for secure URI-based file sharing -->
		<provider
			android:name="androidx.core.content.FileProvider"
			android:authorities="${applicationId}.provider"
			android:exported="false"
			android:grantUriPermissions="true">
			<meta-data
				android:name="android.support.FILE_PROVIDER_PATHS"
				android:resource="@xml/file_paths" />
		</provider>

		<!-- =======================
		     Backend (Parse/Back4App)
		     ======================= -->

		<!-- Server URL -->
		<meta-data
			android:name="com.parse.SERVER_URL"
			android:value="@string/text_back4app_server_url" />

		<!-- Application ID -->
		<meta-data
			android:name="com.parse.APPLICATION_ID"
			android:value="@string/text_back4app_app_id" />

		<!-- Client Key -->
		<meta-data
			android:name="com.parse.CLIENT_KEY"
			android:value="@string/text_back4app_client_key" />
	</application>

	<!-- =======================
	     Queries (package intents)
	     ======================= -->
	<queries>
		<!-- Email sharing support -->
		<intent>
			<action android:name="android.intent.action.SEND" />
			<data android:mimeType="message/rfc822" />
		</intent>

		<!-- Web browsing support -->
		<intent>
			<action android:name="android.intent.action.VIEW" />
			<category android:name="android.intent.category.BROWSABLE" />
			<data android:scheme="https" />
		</intent>

		<!-- Supported third-party apps for sharing and playback -->
		<package android:name="com.google.android.youtube" />
		<package android:name="com.instagram.android" />
		<package android:name="com.facebook.katana" />
		<package android:name="com.whatsapp" />
		<package android:name="com.ted.android" />
		<package android:name="com.google.android.apps.youtube.music" />
		<package android:name="com.soundcloud.android" />
		<package android:name="com.pinterest" />
		<package android:name="com.zhiliaoapp.musically" />
		<package android:name="com.dailymotion.dailymotion" />
		<package android:name="com.reddit.frontpage" />
		<package android:name="com.twitter.android" />
	</queries>
</manifest>